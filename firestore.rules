rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // 游녻 REGRAS PARA USU츼RIOS
    match /users/{userId} {
      // Usu치rios s칩 podem ler/escrever seus pr칩prios dados
      allow read, write: if request.auth != null && request.auth.uid == userId;
      
      // 游 SITES DOS USU츼RIOS (subcole칞칚o)
      match /sites/{siteId} {
        // Permitir leitura p칰blica dos sites, escrita s칩 pelo dono
        allow read: if true;
        allow write: if request.auth != null && request.auth.uid == userId;
      }
    }
    
    // 游깷 SITES GLOBAIS (para slugs 칰nicos e sites publicados)
    match /sites/{siteId} {
      // Qualquer um pode ler sites (para visualiza칞칚o p칰blica)
      allow read: if true;
      
      // Apenas o dono pode escrever
      allow write: if request.auth != null && 
        request.auth.uid == resource.data.userId;
        
      // Permitir cria칞칚o se o usu치rio est치 autenticado e 칠 o dono
      allow create: if request.auth != null && 
        request.auth.uid == request.resource.data.userId;
    }
    
    // 游늯 SITES PUBLICADOS (HTML final)
    match /published_sites/{siteId} {
      // Qualquer um pode ler sites publicados
      allow read: if true;
      
      // Apenas o dono pode publicar/atualizar
      allow write: if request.auth != null && 
        request.auth.uid == resource.data.userId;
        
      // Permitir cria칞칚o se o usu치rio est치 autenticado
      allow create: if request.auth != null && 
        request.auth.uid == request.resource.data.userId;
    }
    
    // 游꿛 TEMPLATES (apenas leitura para todos)
    match /templates/{templateId} {
      // Todos podem ler templates
      allow read: if true;
      
      // Apenas admins podem escrever (adicione UIDs de admin aqui)
      allow write: if request.auth != null && 
        request.auth.uid in ['ADMIN_UID_1', 'ADMIN_UID_2'];
    }
    
    // 游늵 ANALYTICS/STATS (opcional - para m칠tricas)
    match /analytics/{document=**} {
      // Permitir escrita apenas para autenticados (ou ajuste conforme sua necessidade)
      allow read: if false;
      allow write: if request.auth != null;
    }
    
    // 游 REGRA PADR츾O - NEGAR TUDO QUE N츾O FOI ESPECIFICADO
    match /{document=**} {
      allow read, write: if false;
    }
  }
}